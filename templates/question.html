{% extends 'layout.html' %}

{% macro display_table(table, type) %}
    <table>
        <tr>
        {% for header in table[0] %}
            <th>{{ header.capitalize().replace('_', ' ') }}</th>
        {% endfor %}
        </tr>
        {% for row in table %}
            <tr>
                {% for value in row.values() %}
                    {% if value == row.image %}
                        {% if value is none %}
                            <td><p>No picture available</p></td>
                        {% else %}
                            {% set url = url_for('static', filename=value) %}
                            <td><img src="{{ url }}" alt="{{ value }}"></td>
                        {% endif %}
                    {% else %}
                        <td>{{ value }}</td>
                    {% endif %}
                {% endfor %}
{#               <table>
                    <tr>
                        <td>{{ 'No rag added yet' if tag == None else tag['name'] }}</td>
                        <td><a href="{{ url_for('add_edit_tag', question_id=question.id) }}">Add/Edit Rag</a></td>
                        <td><a href="{{ url_for('delete_tag', tag=tag['id'], question_id=question.id) }}">Delete rag</a></td>
                    </tr>
                </table>
#}
                <td class="no-border">
                {% if type in ('answer') %}
                    {% for operation in ('up', 'down') %}
                            {% set url = url_for(
                                'route_answer_votes',
                                answer_id=row.id,
                                operation=operation
                            ) %}
                        <form action="{{ url }}" method="post">
                            <input type="submit" class="{{ operation }}" value="Vote {{ operation }}">
                        </form>
                    {% endfor %}
                {% endif %}
                {% for to_do in ('edit', 'delete') %}
                    {% if type == 'question' %}
                        {% set url = url_for('route_%s_question' % to_do, question_id= row.id) %}
                    {% elif type == 'answer' %}
                        {% set url = url_for('route_%s_answer' % to_do, answer_id= row.id) %}
                    {% endif %}
                        <form action="{{ url }}" method="post">
                            <input type="submit" class="{{ to_do }}" value="{{ to_do.capitalize() }}">
                        </form>
                {% endfor %}
                </td>
            </tr>
        {% endfor %}
    </table>
{% endmacro %}

{% macro add_new(type, suffix='') %}
    <p>
        {% set id = question.id if question else question_id %}
        <a href="{{ url_for('route_add_{}{}'.format(type, suffix), question_id=id) }}">
            Add new {{ type }}
        </a>
    </p>
{% endmacro %}

{% block title %}
    Question details
{% endblock %}

{% block content %}
    <div>
        {% if question %}
            <h1>Question {{ question.id }}</h1>
                {{ display_table([question], 'question') }}
        {% else %}
            <p>There is no question with id {{ question_id }}</p>
        {% endif %}
        {% if answers %}
            <h2>Answers</h2>
            {{ display_table(answers, 'answer') }}
        {% else %}
            <p>There are no answers for this question</p>
        {% endif %}
        {{ add_new('answer') }}
        <h3>Comments</h3>
        {% if comments %}
            {{ display_table(comments, 'comment') }}
        {% else %}
            <p>There are no comments for this question</p>
        {% endif %}
        {{ add_new('comment', '_to_question') }}
        <p>
            <a href="{{ url_for('route_questions_list') }}">
                Back to homepage
            </a>
        </p>
    </div>
{% endblock %}