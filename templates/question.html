{% extends 'layout.html' %}

{% block title %}
    Question details
{% endblock %}

{% block content %}
    <div>
    {% if question %}
        <h1>Question {{ question['id'] }}</h1>
        <table>
            <tr>
            {% for header in question %}
                <th>{{ header.capitalize().replace('_', ' ') }}</th>
            {% endfor %}
            </tr>
            <tr>
            {% for value in question.values() %}
                {% if value == question['image'] %}
                    {% if value == "" %}
                        <td><p>No picture available</p></td>
                    {% else %}
                        <td><img src="{{ value }}" width="120" height="90"></td>
                    {% endif %}
                {% else %}
                    <td>{{ value }}</td>
                {% endif %}
            {% endfor %}
            </tr>
        </table>
        <form action="{{ url_for('route_question_edit', question_id=question['id']) }}" method="post">
            <input type="hidden" name="question" value="{{ question }}">
            <input type="hidden" name="id" value="{{ question['id'] }}">
            <input type="hidden" name="view_number" value="{{ question['view_number'] }}">
            <input type="hidden" name="vote_number" value="{{ question['vote_number'] }}">
            <input id="title" type="hidden" name="title" value="{{question['title']}}">
            <input id="message" type="hidden" name="message" value="{{question['message']}}">
            <input id="image" type="hidden" name="image" value="{{question['image']}}"
                   alt="picture related to question/answer">
            <input type="submit" value="Edit question">
        </form>
        <p>
            <a href="{{ url_for('route_delete_question', question_id=question['id']) }}">
                    Delete question
            </a>
        </p>
        <h2>Answers:</h2>
        {% if answers %}
            <table>
                <tr>
                {% for header in answers[0] %}
                    <th>{{ header.capitalize().replace('_', ' ') }}</th>
                {% endfor %}
                </tr>
                {% for answer in answers %}
                    <tr>
                        {% for value in answer.values() %}
                            {% if value == answer['image'] %}
                                {% if value == "" %}
                                    <td><p>No picture available</p></td>
                                {% else %}
                                    <td><img src="{{ value }}" width="120" height="90"></td>
                                {% endif %}
                            {% else %}
                                <td>{{ value }}</td>
                            {% endif %}
                        {% endfor %}
                        <td class="no-border">
                        {% for operation in ['up', 'down'] %}
                                {% set url = url_for(
                                    'route_answer_votes',
                                    answer_id = answer['id'],
                                    operation = operation
                                ) %}
                            <form action="{{ url }}" method="post">
                                <input type="submit" class="{{ operation }}" value="Vote {{ operation }}">
                            </form>
                        {% endfor %}
                        {% set url = url_for(
                            'route_delete_answer',
                            answer_id=answer['id']
                            ) %}
                            <form action="{{ url }}" method="post">
                                <input type="submit" class="delete" value="Delete">
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>There are no answers for this question</p>
        {% endif %}
    {% else %}
        <p>There is no question with id {{ question_id }}</p>
    {% endif %}
        <p>
            <a href="{{ url_for('route_add_answer', question_id=question['id']) }}">
                Add new answer
            </a>
        </p>
        <p>
            <a href="/">
                Back to homepage
            </a>
        </p>
    </div>
{% endblock %}